<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Google Sheets + Leaflet Map with Clustering</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

  <style>
    #map { height: 90vh; width: 90vw; }
    .custom-cluster {
      background-color: rgba(255, 128, 0, 0.6);
      border-radius: 50%;
      color: white;
      text-align: center;
      font-weight: bold;
      line-height: 40px;
    }
  </style>
</head>
<body>
    <div class="country-buttons">
        <button onclick="zoomTo('NL')">Netherlands</button>
        <button onclick="zoomTo('BD')">Bangladesh</button>
        <button onclick="zoomTo('PK')">Pakistan</button>
        <button onclick="zoomTo('NZ')">New Zealand</button>
        <button onclick="zoomTo('UG')">Uganda</button>
        <button onclick="zoomTo('VN')">Vietnam</button>
    </div>


  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="js/leaflet.js"></script>
  <!-- MarkerCluster JS -->
  <script src="js/leaflet.markercluster.js"></script>

  <!-- PapaParse JS -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  

  <script>
    // Initialize map
    var map = L.map('map').fitBounds([[14.878405511355137,58.79688331610609],[38.59001497686352,97.80756046978819]]);;

        // Country bounding boxes [southWest, northEast]
        const countryBounds = {
          "NL": [[50.5, 3.2], [53.7, 7.3]],     // Netherlands
          "BD": [[20.5, 88.0], [26.7, 92.7]],   // Bangladesh
          "PK": [[23.5, 60.5], [37.3, 77.0]],   // Pakistan
          "NZ": [[-47.5, 166.0], [-34.0, 179.0]], // New Zealand
          "VN": [[8.2, 102.0], [23.5, 110.5]],  // Vietnam
          "UG": [[-1.5, 29.5], [4.5, 35.1]]  // Uganda
        };

        function zoomTo(code) {
          if (countryBounds[code]) {
            map.flyToBounds(countryBounds[code]);
          }
        }

    // Add OpenStreetMap basemap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Create MarkerCluster group with custom icon
    var markers = L.markerClusterGroup({
      iconCreateFunction: function(cluster) {
        return L.divIcon({
          html: '<b>' + cluster.getChildCount() + '</b>',
          className: 'custom-cluster',
          iconSize: L.point(40, 40)
        });
      }
    });

    // Array to store all markers for filtering
    var allMarkers = [];

    // CSV URL from Google Sheets (published as CSV)
    var csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS2J4vkmy4aW2oLt9F4ClqZW165YlqC9nTDPc7XDuimknpyvUmayn3o7ZD8U3repd0JrnAgobZ5X9k0/pub?gid=14019285&single=true&output=csv";

    // Fetch and parse CSV
    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(function(row) {
          if (row.lat && row.lon) {
            var marker = L.marker([parseFloat(row.lat), parseFloat(row.lon)]);
            
                // 1️⃣ Tooltip on hover (shows name only)
            marker.bindTooltip(row.localname, {
              permanent: false,   // disappears when not hovering
              direction: "top",   // tooltip appears above marker
              offset: [0, -10]    // adjust vertical position if needed
            });

            var popupContent = "<b>" + row.name + "</b><br>" +
                               "<b>local name: </b>" + (row.localname || "") + "<br>" +
                               "<b>description:</b><br>" +
                               (row.description || "") + "<br>" +
                               (row.suffix || "");
                                   
            marker.bindPopup(popupContent);
            marker.options.suffix = row.suffix || ""; // store suffix for filtering
            markers.addLayer(marker);
            allMarkers.push(marker);
          }
        });
        map.addLayer(markers);
      }
    });

    // Example: Filter markers by suffix
    function filterMarkers(suffix) {
      markers.clearLayers();
      allMarkers.forEach(function(m) {
        if (m.options.suffix === suffix || !suffix) {
          markers.addLayer(m);
        }
      });
    }

    // Example usage:
    // filterMarkers("A"); // show only markers with suffix "A"
    // filterMarkers("");  // show all markers
  </script>
</body>
</html>
